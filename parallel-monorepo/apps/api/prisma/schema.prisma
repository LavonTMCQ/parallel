generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {

  id              String   @id @default(uuid())

  email           String   @unique

  name            String?

  stripeAccountId String?

  bio             String?

  avatar          String?

  isVerified      Boolean  @default(false)

  

  // Reputation

  createdAt       DateTime @default(now())

  listings        Listing[]

  

  // Two-Way Reviews

  reviewsReceived Review[] @relation("ReceivedReviews")

  reviewsGiven    Review[] @relation("SentReviews")

}



model Review {

  id          String   @id @default(uuid())

  rating      Int      // 1-5

  comment     String

  type        String   // "BUYER_TO_SELLER" or "SELLER_TO_BUYER"

  

  // Relations

  createdAt   DateTime @default(now())

  receiverId  String

  receiver    User     @relation("ReceivedReviews", fields: [receiverId], references: [id])

  

  authorId    String

  author      User     @relation("SentReviews", fields: [authorId], references: [id])

}



model Category {
  id          String     @id @default(uuid())
  name        String     // "Electronics"
  slug        String     @unique // "electronics"
  icon        String?    // Lucide icon name: "monitor", "shirt", etc.
  description String?

  // Hierarchy
  parentId    String?
  parent      Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryTree")

  // Metadata
  sortOrder   Int        @default(0)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())

  // Relations
  listings    Listing[]
}

model Listing {
  id                String   @id @default(uuid())
  sourcePlatform    String
  sourceId          String
  sourceUrl         String?

  title             String
  description       String?
  images            String

  // Category & Discovery
  categoryId        String?
  category          Category? @relation(fields: [categoryId], references: [id])
  brand             String?
  condition         String?  // "new", "like-new", "good", "fair"

  // Source Category (raw from eBay)
  sourceCategoryId  String?
  sourceCategoryPath String? // "Electronics > Cameras & Photo > Digital Cameras"

  // Pricing Data
  priceSource       Float
  shippingSource    Float

  // Parallel Data
  priceParallel     Float
  shippingParallel  Float
  buyerSavings      Float

  // Engagement
  viewCount         Int      @default(0)
  favoriteCount     Int      @default(0)

  status            String   @default("ACTIVE")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  userId            String?
  user              User?    @relation(fields: [userId], references: [id])

  // Indexes for search/filter performance
  @@index([categoryId])
  @@index([status])
  @@index([priceParallel])
  @@index([createdAt])

  // Relations
  offers    Offer[]
  watchers  Watchlist[]
}

model Offer {
  id          String   @id @default(uuid())
  amount      Float
  message     String?
  status      String   @default("PENDING") // PENDING, ACCEPTED, DECLINED, COUNTERED, EXPIRED

  // Counter offer
  counterAmount Float?
  counterMessage String?

  // Expiration
  expiresAt   DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  listingId   String
  listing     Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  buyerId     String?  // Would link to User in production
  buyerEmail  String?  // For guest offers
  buyerName   String?

  @@index([listingId])
  @@index([status])
}

model Watchlist {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())

  // Relations
  listingId   String
  listing     Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  userId      String?
  sessionId   String?  // For anonymous users

  @@unique([listingId, userId])
  @@unique([listingId, sessionId])
  @@index([listingId])
}